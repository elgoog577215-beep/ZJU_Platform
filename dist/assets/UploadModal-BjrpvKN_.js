import{a as l,j as e,d as ce,R as ae,A as de,m as ee}from"./react-vendor-CXoD4tGQ.js";import{aA as ue,X as te,n as z,f as se,j as me,az as ie,aF as pe,I as xe,i as ge,h as he,g as fe}from"./ui-vendor-a_EBNgrH.js";import{u as oe,d as be,b as ve,f as je}from"./index-DpLvsLD6.js";const we=({value:w="",onChange:f})=>{const{t:S}=oe(),[r,s]=l.useState([]),[_,t]=l.useState(""),[E,L]=l.useState([]),[u,i]=l.useState([]),[y,m]=l.useState(!1),b=l.useRef(null),v=l.useRef(null);l.useEffect(()=>{s(w?w.split(",").map(n=>n.trim()).filter(Boolean):[])},[w]),l.useEffect(()=>{C()},[]),l.useEffect(()=>{const n=c=>{v.current&&!v.current.contains(c.target)&&!b.current.contains(c.target)&&m(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]);const C=async()=>{try{const n=await be.get("/tags");i(n.data)}catch(n){console.error("Failed to fetch tags",n)}},F=n=>{const c=n.target.value;if(t(c),c.trim()){const p=u.filter(g=>g.name.toLowerCase().includes(c.toLowerCase())&&!r.includes(g.name));L(p),m(!0)}else m(!1)},j=n=>{var p;const c=n.trim();if(c&&!r.includes(c)){const g=[...r,c];s(g),f(g.join(",")),t(""),m(!1),(p=b.current)==null||p.focus()}},N=n=>{const c=r.filter(p=>p!==n);s(c),f(c.join(","))},T=n=>{n.key==="Enter"?(n.preventDefault(),j(_)):n.key==="Backspace"&&!_&&r.length>0&&N(r[r.length-1])};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 p-2 bg-black/20 border border-white/10 rounded-xl focus-within:border-indigo-500 transition-colors min-h-[50px]",children:[r.map((n,c)=>e.jsxs("span",{className:"flex items-center gap-1 bg-indigo-500/20 text-indigo-300 px-3 py-1 rounded-full text-sm border border-indigo-500/30",children:[e.jsx(ue,{size:12}),n,e.jsx("button",{type:"button",onClick:()=>N(n),className:"hover:text-white transition-colors ml-1",children:e.jsx(te,{size:14})})]},c)),e.jsx("input",{ref:b,type:"text",value:_,onChange:F,onKeyDown:T,onFocus:()=>{_?m(!0):u.length>0&&(L(u.slice(0,5)),m(!0))},className:"bg-transparent border-none outline-none text-white placeholder-gray-500 flex-1 min-w-[120px]",placeholder:r.length===0?S("upload.tags_placeholder"):""})]}),y&&E.length>0&&e.jsx("div",{ref:v,className:"absolute z-50 left-0 right-0 mt-1 bg-gray-900 border border-white/10 rounded-xl shadow-xl max-h-60 overflow-y-auto",children:E.map(n=>e.jsxs("button",{type:"button",onClick:()=>j(n.name),className:"w-full text-left px-4 py-2 text-gray-300 hover:bg-white/10 hover:text-white transition-colors flex justify-between items-center",children:[e.jsx("span",{children:n.name}),e.jsxs("span",{className:"text-xs text-gray-500",children:[n.count," ",S("admin.tag_manager.items_count")]})]},n.id))}),u.length>0&&r.length<5&&!y&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500 py-1",children:S("upload.popular_tags")}),u.slice(0,5).filter(n=>!r.includes(n.name)).map(n=>e.jsx("button",{type:"button",onClick:()=>j(n.name),className:"text-xs bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white px-2 py-1 rounded-lg transition-colors border border-white/5",children:n.name},n.id))]})]})},_e=({isOpen:w,onClose:f,onUpload:S,type:r="image",initialData:s=null,customFields:_=[]})=>{const{t}=oe(),{user:E,isAdmin:L}=ve();ce();const u=!!s,[i,y]=l.useState(null),[m,b]=l.useState((s==null?void 0:s.url)||(s==null?void 0:s.audio)||(s==null?void 0:s.video)||null),[v,C]=l.useState(null),[F,j]=l.useState((s==null?void 0:s.cover)||(s==null?void 0:s.thumbnail)||(s==null?void 0:s.image)||null),[N,T]=l.useState((s==null?void 0:s.title)||""),[n,c]=l.useState((s==null?void 0:s.category)||""),[p,g]=l.useState((s==null?void 0:s.tags)||""),[R,$]=l.useState((s==null?void 0:s.excerpt)||(s==null?void 0:s.description)||""),[re,q]=l.useState((s==null?void 0:s.content)||""),[ne,M]=l.useState((s==null?void 0:s.artist)||""),[B,I]=l.useState((s==null?void 0:s.date)||""),[K,P]=l.useState((s==null?void 0:s.location)||""),[O,U]=l.useState((s==null?void 0:s.link)||"");ae.useEffect(()=>{if(w){if(!E){z.error(t("auth.signin_desc")),f();return}s?(T(s.title||""),c(s.category||t("common.uncategorized")),g(s.tags||""),$(s.excerpt||s.description||""),q(s.content||""),M(s.artist||""),I(s.date||""),P(s.location||""),U(s.link||""),b(s.url||s.audio||s.video||null),j(s.cover||s.thumbnail||s.image||null)):(T(""),c(t("common.uncategorized")),g(""),$(""),q(""),M(""),I(""),P(""),U(""),b(null),j(null)),y(null),C(null)}},[w,s]);const V=(o,x=!1)=>{const a=o.target.files[0];if(a){const d=new FileReader;d.onloadend=()=>{x?(C(a),j(d.result)):(y(a),b(d.result))},d.readAsDataURL(a)}},[h,ye]=l.useState(null),[X,G]=l.useState(!1),le=async o=>{if(o.preventDefault(),!N){z.error(t("upload.title_required"));return}if(!u&&r!=="event"&&r!=="article"&&!i){z.error(t("upload.file_required"));return}G(!0);try{const x=new FormData;i&&x.append("file",i),v&&x.append("cover",v);let a=m,d=F;if(i||v){const D=(await je("/upload",x)).data;i&&(a=D.fileUrl),v&&(d=D.coverUrl)}const A={...s,title:N,category:n,tags:p,tag:p,url:a,audio:r==="audio"?a:null,artist:r==="audio"?ne||t("common.unknown_artist"):null,video:r==="video"?a:null,image:r==="event"?d||"https://images.unsplash.com/photo-1517048676732-d65bc937f952?q=80&w=1000&auto=format&fit=crop":null,date:r==="event"?B:new Date().toLocaleDateString(),location:r==="event"?K:null,link:r==="event"?O:null,status:(s==null?void 0:s.status)||"pending",cover:d||(r==="image"?a:null)||"https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=1000&auto=format&fit=crop",thumbnail:d||(r==="image"?a:null)||"https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=1000&auto=format&fit=crop",excerpt:R,content:re||`<p>${R}</p>`,description:R,...u?{}:{duration:0,size:"small"}};await S(A);const k=t(u?"upload.update_success":L?"upload.upload_success":"upload.upload_pending_review");z.success(k),f()}catch(x){console.error("Upload failed:",x),z.error(t("upload.upload_failed"))}finally{G(!1)}},H=()=>{switch(r){case"video":return e.jsx(fe,{size:48,className:"text-gray-400"});case"audio":return e.jsx(se,{size:48,className:"text-gray-400"});case"article":return e.jsx(he,{size:48,className:"text-gray-400"});case"event":return e.jsx(ge,{size:48,className:"text-gray-400"});default:return e.jsx(xe,{size:48,className:"text-gray-400"})}},J=(o=!1)=>{if(o)return"image/*";switch(r){case"video":return"video/*";case"audio":return"audio/*";case"article":return"image/*";case"event":return"image/*";default:return"image/*"}},Q=o=>{o.preventDefault(),o.stopPropagation(),setIsDragging(!0)},W=o=>{o.preventDefault(),o.stopPropagation(),setIsDragging(!1)},Y=o=>{o.preventDefault(),o.stopPropagation(),setIsDragging(!0)},Z=(o,x=!1)=>{o.preventDefault(),o.stopPropagation(),setIsDragging(!1);const a=o.dataTransfer.files[0];if(a){const d=J(x),A=new RegExp(d.replace("*",".*"));if(!a.type.match(A)){z.error(t("upload.invalid_file_type",{type:d}));return}const k=new FileReader;k.onloadend=()=>{x?(C(a),j(k.result)):(y(a),b(k.result))},k.readAsDataURL(a)}};return e.jsx(de,{children:w&&e.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",onClick:f,children:e.jsxs(ee.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"relative bg-[#1a1a1a] border border-white/10 rounded-2xl w-full max-w-lg overflow-hidden shadow-2xl max-h-[90vh] overflow-y-auto custom-scrollbar z-10",onClick:o=>o.stopPropagation(),children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-purple-500/5 opacity-50 pointer-events-none"}),e.jsxs("div",{className:"p-6 border-b border-white/10 flex justify-between items-center sticky top-0 bg-[#1a1a1a]/95 backdrop-blur-md z-20",children:[e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[H()," ",t(u?"admin.edit_item":"common.upload")," ",t(`common.${r}`)]}),e.jsx("button",{onClick:f,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(te,{size:24})})]}),e.jsxs("form",{onSubmit:le,className:"p-6 space-y-6 relative z-10",children:[r!=="event"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:t(`common.${r}`)}),e.jsxs("div",{className:`relative border-2 border-dashed rounded-xl p-8 flex flex-col items-center justify-center group transition-all duration-300 bg-white/5 ${h==="main"?"border-indigo-500 bg-indigo-500/10 scale-[1.02]":"border-white/20 hover:border-white/40"}`,onDragEnter:o=>Q(o),onDragLeave:W,onDragOver:Y,onDrop:o=>Z(o,!1),children:[e.jsx("input",{type:"file",accept:J(),onChange:o=>V(o,!1),className:"absolute inset-0 opacity-0 cursor-pointer z-10"}),m?r==="audio"?e.jsxs("div",{className:"text-center relative z-20 pointer-events-none",children:[e.jsx(se,{size:48,className:"text-green-400 mx-auto mb-2"}),e.jsx("p",{className:"text-green-400 font-medium text-sm break-all",children:i==null?void 0:i.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t("upload.click_drag_replace")})]}):r==="video"?e.jsx("div",{className:"relative z-20 pointer-events-none w-full flex justify-center",children:e.jsx("video",{src:m,className:"max-h-48 rounded-lg",controls:!0})}):e.jsx("div",{className:"relative z-20 pointer-events-none",children:e.jsx("img",{src:m,alt:"Preview",className:"max-h-48 rounded-lg object-cover shadow-lg"})}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-center pointer-events-none",children:[e.jsx("div",{className:`mb-4 transition-transform duration-300 ${h==="main"?"scale-110 text-indigo-400":"group-hover:scale-110 text-gray-400"}`,children:h==="main"?e.jsx(me,{size:48}):H()}),e.jsx("p",{className:"text-gray-300 font-medium",children:h==="main"?t("upload.drop_file"):`${t("common.upload")} ${t(`common.${r}`)}`}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:t("upload.drag_drop_browse")})]})]})]}),(r==="audio"||r==="video"||r==="event")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:t(r==="event"?"common.image":"common.cover")}),e.jsxs("div",{className:`relative border-2 border-dashed rounded-xl p-4 flex flex-col items-center justify-center group transition-all duration-300 bg-white/5 h-32 ${h==="cover"?"border-indigo-500 bg-indigo-500/10 scale-[1.02]":"border-white/20 hover:border-white/40"}`,onDragEnter:o=>Q(o),onDragLeave:W,onDragOver:Y,onDrop:o=>Z(o,!0),children:[e.jsx("input",{type:"file",accept:"image/*",onChange:o=>V(o,!0),className:"absolute inset-0 opacity-0 cursor-pointer z-10"}),F?e.jsxs("div",{className:"relative h-full w-full flex justify-center items-center pointer-events-none",children:[e.jsx("img",{src:F,alt:"Cover Preview",className:"h-full rounded-lg object-contain"}),e.jsx("div",{className:`absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity ${h==="cover"?"opacity-100":""}`,children:e.jsx("p",{className:"text-xs text-white",children:t("upload.replace")})})]}):e.jsxs("div",{className:"flex flex-col items-center pointer-events-none",children:[e.jsx(ie,{size:24,className:`mb-1 transition-colors ${h==="cover"?"text-indigo-400":"text-gray-400"}`}),e.jsx("span",{className:`text-xs transition-colors ${h==="cover"?"text-indigo-300":"text-gray-500"}`,children:h==="cover"?t("upload.drop_image"):`${t("common.upload")} ${t("common.image")}`})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("common.title")}),e.jsx("input",{type:"text",required:!0,value:N,onChange:o=>T(o.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-white/30",placeholder:t("upload.title_placeholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("upload.tags")}),e.jsx(we,{value:p,onChange:g,placeholder:t("upload.tags_placeholder")})]}),r==="event"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("common.date")}),e.jsx("input",{type:"date",required:!0,value:B,onChange:o=>I(o.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-white/30"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("common.location")}),e.jsx("input",{type:"text",required:!0,value:K,onChange:o=>P(o.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-white/30",placeholder:t("upload.location_placeholder")})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("upload.event_link")}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"}),e.jsx("input",{type:"url",value:O,onChange:o=>U(o.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg pl-10 pr-4 py-2 text-white focus:outline-none focus:border-white/30",placeholder:"https://"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("admin.fields.description")}),e.jsx("textarea",{value:R,onChange:o=>$(o.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-white/30 h-24 resize-none",placeholder:t("upload.description_placeholder")})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-white/10",children:[e.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 text-gray-400 hover:text-white transition-colors",children:t("common.cancel")}),e.jsx("button",{type:"submit",disabled:X,className:"px-6 py-2 bg-white text-black rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:X?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin"}),t("common.loading")]}):e.jsx(e.Fragment,{children:t(u?"common.save":"common.upload")})})]})]})]})})})};export{_e as U};
