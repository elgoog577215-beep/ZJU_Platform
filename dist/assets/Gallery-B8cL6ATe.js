import{a as n,j as e,m as j,A as I,i as F}from"./react-vendor-CXoD4tGQ.js";import{_,J as O,V as T,X as C,$ as V,a0 as M,a1 as B,a2 as G,a3 as K,m as $,n as S,j as X,a4 as J}from"./ui-vendor-a_EBNgrH.js";import{b as q,F as H,u as Q,a as W,c as z,d as P}from"./index-BobQeNdV.js";import{S as Y,a as Z,P as ee}from"./SortSelector-B0HGnSS6.js";import{U as te}from"./UploadModal-DNZchTTZ.js";import{u as se}from"./useCachedResource-DDdzs2K9.js";import"./three-vendor-BxbFXkJv.js";import"./utils-fLfdUYuo.js";const ae=({photo:s,onClose:c,onNext:h,onPrev:l,onView3D:p,onLikeToggle:w})=>{const[u,b]=n.useState(!1),{user:r}=q();n.useEffect(()=>{const a=o=>{o.key==="Escape"&&c(),o.key==="ArrowRight"&&h(),o.key==="ArrowLeft"&&l(),o.key==="i"&&b(x=>!x)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[c,h,l]);const f=async()=>{try{const o=await(await fetch(s.url)).blob(),x=window.URL.createObjectURL(o),m=document.createElement("a");m.href=x,m.download=s.title||"download",document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(x),S.success("Download started")}catch(a){console.error(a),S.error("Download failed")}},d={camera:"Sony A7R IV",lens:"FE 24-70mm GM",aperture:"f/2.8",shutter:"1/250s",iso:"100"};return e.jsxs(j.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/95 backdrop-blur-md p-4",onClick:c,children:[e.jsxs("div",{className:"absolute top-4 right-4 flex gap-4 z-50",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-2 bg-black/40 backdrop-blur-md rounded-full p-1 border border-white/10",children:[e.jsx("button",{onClick:p,className:"p-3 text-white/70 hover:text-cyan-400 hover:bg-white/10 rounded-full transition-all",title:"3D View",children:e.jsx(_,{size:20})}),e.jsx("div",{className:"w-px h-4 bg-white/20"}),e.jsx(H,{itemId:s.id,itemType:"photo",className:"p-3 hover:bg-white/10 rounded-full",onToggle:w,favorited:s.favorited,initialFavorited:s.favorited}),e.jsx("button",{onClick:f,className:"p-3 text-white/70 hover:text-green-400 hover:bg-white/10 rounded-full transition-all",title:"Download",children:e.jsx(O,{size:20})}),e.jsx("button",{onClick:()=>b(!u),className:`p-3 rounded-full transition-all ${u?"text-white bg-white/20":"text-white/70 hover:text-white hover:bg-white/10"}`,title:"Info",children:e.jsx(T,{size:20})})]}),e.jsx("button",{onClick:c,className:"p-3 bg-black/40 hover:bg-red-500/20 text-white/70 hover:text-red-400 border border-white/10 rounded-full backdrop-blur-md transition-all",children:e.jsx(C,{size:24})})]}),e.jsxs("div",{className:"relative max-w-7xl max-h-[90vh] w-full flex items-center justify-center",onClick:a=>a.stopPropagation(),children:[e.jsx("button",{onClick:l,className:"absolute left-0 md:-left-16 p-4 text-white/50 hover:text-white transition-colors hover:bg-white/5 rounded-full",children:e.jsx(V,{size:48})}),e.jsx(j.img,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{type:"spring",stiffness:300,damping:30},src:s.url,alt:s.title,className:"max-w-full max-h-[85vh] object-contain shadow-2xl rounded-sm"},s.id),e.jsx("button",{onClick:h,className:"absolute right-0 md:-right-16 p-4 text-white/50 hover:text-white transition-colors hover:bg-white/5 rounded-full",children:e.jsx(M,{size:48})}),e.jsxs("div",{className:"absolute -bottom-16 left-0 right-0 text-center",children:[e.jsx("h3",{className:"text-2xl font-serif font-bold text-white mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-gray-400 uppercase tracking-widest",children:s.category})]})]}),e.jsx(I,{children:u&&e.jsxs(j.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",stiffness:300,damping:30},className:"fixed top-0 right-0 bottom-0 w-80 bg-[#1a1a1a]/95 backdrop-blur-xl border-l border-white/10 p-6 z-[70] overflow-y-auto",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Info"}),e.jsx("button",{onClick:()=>b(!1),className:"text-gray-400 hover:text-white",children:e.jsx(C,{size:20})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-gray-500 uppercase mb-2",children:"Title"}),e.jsx("p",{className:"text-white text-lg font-serif",children:s.title})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-gray-500 uppercase mb-2",children:"Category"}),e.jsx("span",{className:"px-3 py-1 bg-white/10 rounded-full text-sm text-white",children:s.category})]}),e.jsxs("div",{className:"border-t border-white/10 pt-6",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-500 uppercase mb-4",children:"EXIF Data"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-gray-300",children:[e.jsx(B,{size:18,className:"text-indigo-400"}),e.jsx("span",{children:d.camera})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-300",children:[e.jsx(G,{size:18,className:"text-pink-400"}),e.jsx("span",{children:d.lens})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-300",children:[e.jsx(K,{size:18,className:"text-green-400"}),e.jsxs("span",{children:["ISO ",d.iso]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-300",children:[e.jsx($,{size:18,className:"text-yellow-400"}),e.jsx("span",{children:d.shutter})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-300",children:[e.jsx("div",{className:"w-4 h-4 rounded-full border-2 border-blue-400 flex items-center justify-center text-[10px]",children:"f"}),e.jsx("span",{children:d.aperture})]})]})]}),e.jsxs("div",{className:"border-t border-white/10 pt-6",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-500 uppercase mb-2",children:"Stats"}),e.jsxs("div",{className:"flex justify-between text-gray-300 text-sm",children:[e.jsx("span",{children:"Likes"}),e.jsx("span",{className:"text-white font-bold",children:s.likes||0})]}),e.jsxs("div",{className:"flex justify-between text-gray-300 text-sm mt-2",children:[e.jsx("span",{children:"Views"}),e.jsx("span",{className:"text-white font-bold",children:Math.floor(Math.random()*1e3)+100})]})]})]})]})})]})},pe=()=>{const[s]=F(),[c,h]=n.useState("newest"),{t:l}=Q(),{settings:p}=W(),[w,u]=n.useState(1),b=p.pagination_enabled==="true"?12:1e3,{data:r,pagination:f,loading:d,error:a,setData:o,refresh:x}=se("/photos",{page:w,limit:b,sort:c},{dependencies:[p.pagination_enabled]}),m=(f==null?void 0:f.totalPages)||1,[ie,le]=n.useState(0),[y,g]=n.useState(null),[k,N]=n.useState(!1);z(y!==null,()=>g(null)),z(k,()=>N(!1)),n.useEffect(()=>{const t=s.get("id");t&&P.get(`/photos/${t}`).then(i=>{i.data}).catch(i=>console.error("Failed to fetch deep linked photo",i))},[s]);const L=t=>{P.post("/photos",t).then(()=>{x()}).catch(i=>console.error("Failed to save photo",i))},R=()=>{g(t=>(t+1)%r.length)},U=()=>{g(t=>(t-1+r.length)%r.length)},E=t=>{L(t)},D=t=>{u(t),window.scrollTo({top:0,behavior:"smooth"})};return e.jsxs("section",{className:"pt-24 pb-40 md:py-20 px-4 md:px-8 min-h-screen",children:[e.jsxs(j.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.6},viewport:{once:!0},className:"mb-8 md:mb-12 relative z-40 text-center",children:[e.jsx("button",{onClick:()=>N(!0),className:"absolute right-0 top-0 md:top-2 bg-white/10 hover:bg-white/20 text-white p-2 md:p-3 rounded-full backdrop-blur-md border border-white/10 transition-all",title:l("common.upload_photo"),children:e.jsx(X,{size:18,className:"md:w-5 md:h-5"})}),e.jsx("h2",{className:"text-4xl md:text-5xl font-bold font-serif mb-4 md:mb-6",children:l("gallery.title")}),e.jsx("p",{className:"text-gray-400 max-w-xl mx-auto mb-6 md:mb-8 text-sm md:text-base",children:l("gallery.subtitle")}),e.jsx("div",{className:"flex flex-wrap justify-center items-center gap-4 relative z-50",children:e.jsx(Y,{sort:c,onSortChange:h})})]}),d&&r.length===0?e.jsx("div",{className:"columns-2 md:columns-3 lg:columns-4 gap-4 md:gap-8 max-w-7xl mx-auto space-y-4 md:space-y-8",children:[1,2,3,4,5,6,7,8].map(t=>e.jsx("div",{className:"bg-white/5 rounded-3xl h-48 md:h-80 animate-pulse break-inside-avoid w-full inline-block"},t))}):a?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx(J,{size:48,className:"text-red-400 mb-4 opacity-50 mx-auto"}),e.jsx("p",{className:"text-gray-300 mb-6",children:l("common.error_fetching_data")||"Failed to load photos"}),e.jsx("button",{onClick:x,className:"px-6 py-2 bg-white/10 hover:bg-white/20 text-white rounded-full transition-all border border-white/10",children:l("common.retry")||"Retry"})]}):e.jsx("div",{className:"columns-2 md:columns-3 lg:columns-4 gap-3 md:gap-8 max-w-7xl mx-auto space-y-3 md:space-y-8 pb-20 md:pb-0",children:r.map((t,i)=>e.jsxs(j.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3},className:"break-inside-avoid relative group overflow-hidden rounded-xl md:rounded-lg cursor-pointer border border-white/5 hover:border-white/20 hover:shadow-2xl hover:shadow-white/5 transition-all duration-300 w-full inline-block touch-manipulation",onClick:()=>g(i),children:[e.jsx(Z,{src:t.url,alt:t.title,type:"image",className:"w-full h-auto",imageClassName:"h-auto object-cover transform transition-transform duration-700 group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col items-center justify-center text-center p-4",children:e.jsx("h3",{className:"text-xl font-bold font-serif mb-2 translate-y-4 group-hover:translate-y-0 transition-transform duration-300",children:t.title})})]},t.id))}),p.pagination_enabled==="true"&&e.jsx(ee,{currentPage:w,totalPages:m,onPageChange:D}),e.jsx(I,{children:y!==null&&e.jsx(ae,{photo:r[y],onClose:()=>g(null),onNext:R,onPrev:U,onLikeToggle:(t,i)=>{o(A=>A.map(v=>v.id===r[y].id?{...v,likes:i!==void 0?i:v.likes,favorited:t}:v))}})}),e.jsx(te,{isOpen:k,onClose:()=>N(!1),onUpload:E,type:"image"})]})};export{pe as default};
