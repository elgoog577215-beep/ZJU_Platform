import{i as oe,a as i,j as e,m as S}from"./react-vendor-CXoD4tGQ.js";import{U as ce}from"./UploadModal-CVD3aw18.js";import{u as de,a as me,e as ue,d as b,F as O}from"./index-Dt-4iKrO.js";import{S as xe,a as R,P as he}from"./SortSelector-BKQ8ZIk_.js";import{j as pe,f as _,z as fe,w as ge,x as be,y as ve,a5 as je,a6 as we,a4 as ye}from"./ui-vendor-a_EBNgrH.js";import"./three-vendor-BxbFXkJv.js";import"./utils-fLfdUYuo.js";const C=a=>{const c=Math.floor(a/60),u=Math.floor(a%60);return`${c}:${u<10?"0":""}${u}`},Ie=()=>{const{t:a}=de(),{settings:c}=me(),[u]=oe(),{currentTrack:d,isPlaying:x,playTrack:z,togglePlay:L,nextTrack:A,prevTrack:B,audioRef:r}=ue(),[m,h]=i.useState([]),[K,v]=i.useState(!0),[p,X]=i.useState(1),[q,P]=i.useState(1),[j,D]=i.useState("newest"),[G,T]=i.useState(!1),[H,Ne]=i.useState(0);i.useEffect(()=>{const t=u.get("id");t&&b.get(`/music/${t}`).then(s=>{s.data&&z(s.data)}).catch(s=>console.error("Failed to fetch deep linked music",s))},[u]);const[I,w]=i.useState(0),[E,F]=i.useState(.5),[y,f]=i.useState(!1),[J,$]=i.useState(!1);i.useEffect(()=>{v(!0);const t=c.pagination_enabled==="true"?12:1e3,s={page:p,limit:t,sort:j};b.get("/music",{params:s}).then(l=>{h(l.data.data),P(l.data.pagination.totalPages),v(!1),T(!1)}).catch(l=>{console.error("Failed to fetch music:",l),v(!1),T(!0)})},[p,j,c.pagination_enabled,H]);const Q=t=>{b.post("/music",t).then(()=>{const s=c.pagination_enabled==="true"?10:1e3;return b.get(`/music?page=${p}&limit=${s}`)}).then(s=>{h(s.data.data),P(s.data.pagination.totalPages)}).catch(s=>console.error("Failed to save music",s))};i.useEffect(()=>{const t=r.current,s=()=>w(t.currentTime);return t.addEventListener("timeupdate",s),w(t.currentTime),F(t.volume),f(t.muted),()=>{t.removeEventListener("timeupdate",s)}},[r,d]);const W=t=>{const s=parseFloat(t.target.value);r.current.currentTime=s,w(s)},Y=t=>{const s=parseFloat(t.target.value);F(s),r.current.volume=s,f(s===0)},Z=()=>{y?(r.current.volume=E,f(!1)):(r.current.volume=0,f(!0))},ee=()=>A(),te=()=>B(),se=t=>{X(t)},ae=t=>{Q(t)},[M,U]=i.useState(1),N=[.5,.75,1,1.25,1.5,2],ie=()=>{const s=(N.indexOf(M)+1)%N.length,l=N[s];U(l),r.current.playbackRate=l};i.useEffect(()=>{U(1),r.current&&(r.current.playbackRate=1)},[d]);const[ne,k]=i.useState({});i.useEffect(()=>{k({})},[d==null?void 0:d.id]);const le={title:a("music.select_track"),artist:a("music.to_start"),duration:0,cover:"https://via.placeholder.com/300",audio:""},V=d||le,re=m.find(t=>t.id===V.id),n={...V,...ne,...re||{}};return e.jsxs("section",{className:"pt-24 pb-40 md:py-20 px-4 md:px-8 min-h-screen",children:[e.jsxs(S.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.6},viewport:{once:!0},className:"mb-8 md:mb-12 relative z-40 text-center",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold font-serif mb-4 md:mb-6",children:a("music.title")}),e.jsx("p",{className:"text-gray-400 max-w-xl mx-auto text-sm md:text-base",children:a("music.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto justify-center md:absolute md:right-0 md:top-0",children:[e.jsx("div",{className:"w-40 md:w-48",children:e.jsx(xe,{sort:j,onSortChange:D})}),e.jsx("button",{onClick:()=>$(!0),className:"bg-white/10 hover:bg-white/20 text-white p-2 md:p-3 rounded-full backdrop-blur-md border border-white/10 transition-all",title:a("common.upload_music"),children:e.jsx(pe,{size:18,className:"md:w-5 md:h-5"})})]})]}),e.jsxs("div",{className:"max-w-6xl w-full mx-auto grid lg:grid-cols-2 gap-8 md:gap-16 items-center relative",children:[e.jsxs(S.div,{initial:{opacity:0,x:-50},animate:{opacity:1,x:0},transition:{duration:.6},className:"hidden md:block bg-[#0a0a0a]/50 backdrop-blur-2xl border border-white/20 rounded-3xl p-6 md:p-12 shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-white/5 backdrop-blur-3xl z-0 rounded-3xl",style:{backgroundImage:`url(${n.cover})`,backgroundSize:"cover",backgroundPosition:"center"}}),e.jsx("div",{className:"absolute inset-0 bg-black/40 z-0"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6 sticky top-0 bg-white/5 backdrop-blur-2xl border border-white/20 p-4 rounded-xl z-10 shadow-lg",children:[e.jsx("div",{className:"p-3 bg-cyan-500/20 rounded-full text-cyan-400",children:e.jsx(_,{size:24})}),e.jsx("div",{children:e.jsx("h2",{className:"text-xl md:text-2xl font-bold font-serif",children:a("music.title")})})]}),e.jsx("div",{className:"flex justify-center mb-6 md:mb-8",children:e.jsxs("div",{className:"relative w-48 h-48 md:w-56 md:h-56 rounded-full border-4 border-white/10 shadow-2xl overflow-hidden animate-[spin_4s_linear_infinite]",style:{animationPlayState:x?"running":"paused"},children:[e.jsx(R,{src:n.cover,alt:n.title,type:"music",className:"w-full h-full",imageClassName:"w-full h-full object-cover",iconSize:64}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 bg-black rounded-full border-2 border-white/20"})})]})}),e.jsxs("div",{className:"text-center mb-8 relative",children:[e.jsx("h2",{className:"text-3xl font-bold text-white mb-2 px-8",children:n.title}),e.jsx("p",{className:"text-cyan-400 font-medium mb-4",children:n.artist}),n.id&&e.jsx("div",{className:"flex justify-center",children:e.jsx(O,{itemId:n.id,itemType:"music",size:20,showCount:!0,count:n.likes,favorited:n.favorited,className:"p-2 bg-white/5 hover:bg-cyan-500/20 rounded-full transition-colors border border-white/10",onToggle:(t,s)=>{k({likes:s,favorited:t}),h(l=>l.map(o=>o.id===n.id?{...o,likes:s!==void 0?s:o.likes,favorited:t}:o))}})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("input",{type:"range",min:"0",max:n.duration||100,value:I,onChange:W,className:"w-full h-1 bg-white/10 rounded-full appearance-none cursor-pointer accent-cyan-400 hover:accent-cyan-300"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 font-mono mt-2",children:[e.jsx("span",{children:C(I)}),e.jsx("span",{children:C(n.duration)})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-8",children:[e.jsx("button",{onClick:te,className:"p-3 text-gray-400 hover:text-white hover:bg-white/10 rounded-full transition-all active:scale-95",title:a("common.previous_track"),children:e.jsx(fe,{size:28})}),e.jsx("button",{onClick:L,className:"w-20 h-20 bg-gradient-to-br from-cyan-400 to-blue-600 text-white rounded-full flex items-center justify-center shadow-[0_0_20px_rgba(34,211,238,0.3)] hover:shadow-[0_0_30px_rgba(34,211,238,0.5)] hover:scale-105 active:scale-95 transition-all",title:a(x?"common.pause":"common.play"),children:x?e.jsx(ge,{size:32,fill:"currentColor"}):e.jsx(be,{size:32,fill:"currentColor",className:"ml-1"})}),e.jsx("button",{onClick:ee,className:"p-3 text-gray-400 hover:text-white hover:bg-white/10 rounded-full transition-all active:scale-95",title:a("common.next_track"),children:e.jsx(ve,{size:28})})]}),e.jsxs("button",{onClick:ie,className:"text-xs font-bold text-cyan-400 border border-cyan-500/30 bg-cyan-500/5 px-4 py-1.5 rounded-full hover:bg-cyan-500/20 hover:border-cyan-500/50 transition-all active:scale-95 uppercase tracking-wider",title:a("common.playback_speed"),children:[M,"x ",a("common.speed")]})]}),e.jsxs("div",{className:"flex items-center gap-3 justify-center text-gray-400",children:[e.jsx("button",{onClick:Z,className:"p-2 hover:bg-white/10 rounded-full transition-colors hover:text-white",title:a(y?"common.unmute":"common.mute"),children:y?e.jsx(je,{size:20}):e.jsx(we,{size:20})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:E,onChange:Y,className:"w-24 h-1 bg-white/10 rounded-full appearance-none cursor-pointer accent-gray-400 hover:accent-white transition-all"})]})]})]}),e.jsxs("div",{className:"flex flex-col h-[600px]",children:[e.jsxs(S.div,{initial:{opacity:0,x:50},whileInView:{opacity:1,x:0},transition:{duration:.6},viewport:{once:!0},className:"flex-1 overflow-y-auto custom-scrollbar pr-2",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4 sticky top-0 bg-white/5 backdrop-blur-2xl border border-white/20 p-4 rounded-xl z-10 shadow-lg",children:[e.jsx("div",{className:"p-3 bg-cyan-500/20 rounded-full text-cyan-400",children:e.jsx(_,{size:24})}),e.jsxs("h3",{className:"text-xl md:text-2xl font-bold",children:[a("music.title")," (",m.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:K&&m.length===0?[...Array(5)].map((t,s)=>e.jsxs("div",{className:"p-4 rounded-xl flex items-center gap-4 bg-white/5 animate-pulse",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-white/10 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-1/3"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-1/4"})]})]},s)):G?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(ye,{size:48,className:"text-red-400 mb-4 opacity-50 mx-auto"}),e.jsx("p",{className:"text-gray-300 mb-6",children:a("common.error_fetching_data")||"Failed to load music"}),e.jsx("button",{onClick:refresh,className:"px-6 py-2 bg-white/10 hover:bg-white/20 text-white rounded-full transition-all border border-white/10",children:a("common.retry")||"Retry"})]}):e.jsxs(e.Fragment,{children:[m.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(_,{size:48,className:"mx-auto mb-4 opacity-20"}),e.jsx("p",{children:a("music.no_tracks")})]}),m.map(t=>e.jsxs("div",{onClick:()=>z(t,m),className:`p-4 rounded-xl flex items-center gap-4 cursor-pointer transition-all border border-transparent
                    ${n.id===t.id?"bg-white/10 border-white/10":"hover:bg-white/5"}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx(R,{src:t.cover,alt:t.title,type:"music",className:"w-full h-full",imageClassName:"w-full h-full object-cover",iconSize:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-bold ${n.id===t.id?"text-cyan-400":"text-white"}`,children:t.title}),e.jsx("p",{className:"text-sm text-gray-400",children:t.artist})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-gray-500 font-mono",children:C(t.duration)}),e.jsx(O,{itemId:t.id,itemType:"music",size:16,showCount:!0,count:t.likes,favorited:t.favorited,className:"p-2 hover:bg-white/10 rounded-full transition-colors group",onToggle:(s,l)=>{h(o=>o.map(g=>g.id===t.id?{...g,likes:l!==void 0?l:g.likes,favorited:s}:g)),n.id===t.id&&k(o=>({...o,likes:l,favorited:s}))}})]}),n.id===t.id&&x&&e.jsxs("div",{className:"flex gap-0.5 items-end h-4",children:[e.jsx("div",{className:"w-1 bg-cyan-400 animate-[music-bar_1s_ease-in-out_infinite] h-full"}),e.jsx("div",{className:"w-1 bg-cyan-400 animate-[music-bar_1.2s_ease-in-out_infinite] h-2/3"}),e.jsx("div",{className:"w-1 bg-cyan-400 animate-[music-bar_0.8s_ease-in-out_infinite] h-1/2"})]})]},t.id))]})})]}),c.pagination_enabled==="true"&&e.jsx("div",{className:"mt-4",children:e.jsx(he,{currentPage:p,totalPages:q,onPageChange:se})})]})]}),e.jsx(ce,{isOpen:J,onClose:()=>$(!1),onUpload:ae,type:"audio"})]})};export{Ie as default};
