import{a as l,j as e,d as ae,R as de,A as ue,m as se}from"./react-vendor-CXoD4tGQ.js";import{aA as me,X as oe,n as S,f as te,j as ie,az as pe,aF as ge,I as xe,i as he,h as fe,g as ve}from"./ui-vendor-a_EBNgrH.js";import{u as re,d as be,b as je,f as we}from"./index-fiORcRZL.js";const ye=({value:b="",onChange:h})=>{const{t:_}=re(),[r,s]=l.useState([]),[C,t]=l.useState(""),[E,L]=l.useState([]),[j,w]=l.useState([]),[u,m]=l.useState(!1),f=l.useRef(null),v=l.useRef(null);l.useEffect(()=>{s(b?b.split(",").map(n=>n.trim()).filter(Boolean):[])},[b]),l.useEffect(()=>{k()},[]),l.useEffect(()=>{const n=c=>{v.current&&!v.current.contains(c.target)&&!f.current.contains(c.target)&&m(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]);const k=async()=>{try{const n=await be.get("/tags");w(n.data)}catch(n){console.error("Failed to fetch tags",n)}},F=n=>{const c=n.target.value;if(t(c),c.trim()){const p=j.filter(g=>g.name.toLowerCase().includes(c.toLowerCase())&&!r.includes(g.name));L(p),m(!0)}else m(!1)},y=n=>{var p;const c=n.trim();if(c&&!r.includes(c)){const g=[...r,c];s(g),h(g.join(",")),t(""),m(!1),(p=f.current)==null||p.focus()}},N=n=>{const c=r.filter(p=>p!==n);s(c),h(c.join(","))},T=n=>{n.key==="Enter"?(n.preventDefault(),y(C)):n.key==="Backspace"&&!C&&r.length>0&&N(r[r.length-1])};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 p-2 bg-black/20 border border-white/10 rounded-xl focus-within:border-indigo-500 transition-colors min-h-[50px]",children:[r.map((n,c)=>e.jsxs("span",{className:"flex items-center gap-1 bg-indigo-500/20 text-indigo-300 px-3 py-1 rounded-full text-sm border border-indigo-500/30",children:[e.jsx(me,{size:12}),n,e.jsx("button",{type:"button",onClick:()=>N(n),className:"hover:text-white transition-colors ml-1",children:e.jsx(oe,{size:14})})]},c)),e.jsx("input",{ref:f,type:"text",value:C,onChange:F,onKeyDown:T,onFocus:()=>{C?m(!0):j.length>0&&(L(j.slice(0,5)),m(!0))},className:"bg-transparent border-none outline-none text-white placeholder-gray-500 flex-1 min-w-[120px]",placeholder:r.length===0?_("upload.tags_placeholder"):""})]}),u&&E.length>0&&e.jsx("div",{ref:v,className:"absolute z-50 left-0 right-0 mt-1 bg-gray-900 border border-white/10 rounded-xl shadow-xl max-h-60 overflow-y-auto",children:E.map(n=>e.jsxs("button",{type:"button",onClick:()=>y(n.name),className:"w-full text-left px-4 py-2 text-gray-300 hover:bg-white/10 hover:text-white transition-colors flex justify-between items-center",children:[e.jsx("span",{children:n.name}),e.jsxs("span",{className:"text-xs text-gray-500",children:[n.count," ",_("admin.tag_manager.items_count")]})]},n.id))}),j.length>0&&r.length<5&&!u&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500 py-1",children:_("upload.popular_tags")}),j.slice(0,5).filter(n=>!r.includes(n.name)).map(n=>e.jsx("button",{type:"button",onClick:()=>y(n.name),className:"text-xs bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white px-2 py-1 rounded-lg transition-colors border border-white/5",children:n.name},n.id))]})]})},Ce=({isOpen:b,onClose:h,onUpload:_,type:r="image",initialData:s=null,customFields:C=[]})=>{const{t}=re(),{user:E,isAdmin:L}=je(),j=ae(),w=!!s,[u,m]=l.useState(null),[f,v]=l.useState((s==null?void 0:s.url)||(s==null?void 0:s.audio)||(s==null?void 0:s.video)||null),[k,F]=l.useState(null),[y,N]=l.useState((s==null?void 0:s.cover)||(s==null?void 0:s.thumbnail)||(s==null?void 0:s.image)||null),[T,n]=l.useState((s==null?void 0:s.title)||""),[c,p]=l.useState((s==null?void 0:s.category)||""),[g,$]=l.useState((s==null?void 0:s.tags)||""),[R,I]=l.useState((s==null?void 0:s.excerpt)||(s==null?void 0:s.description)||""),[ne,M]=l.useState((s==null?void 0:s.content)||""),[le,B]=l.useState((s==null?void 0:s.artist)||""),[K,P]=l.useState((s==null?void 0:s.date)||""),[O,U]=l.useState((s==null?void 0:s.location)||""),[V,A]=l.useState((s==null?void 0:s.link)||"");de.useEffect(()=>{if(b){if(!E){S.error(t("auth.signin_desc")),h();return}s?(n(s.title||""),p(s.category||t("common.uncategorized")),$(s.tags||""),I(s.excerpt||s.description||""),M(s.content||""),B(s.artist||""),P(s.date||""),U(s.location||""),A(s.link||""),v(s.url||s.audio||s.video||null),N(s.cover||s.thumbnail||s.image||null)):(n(""),p(t("common.uncategorized")),$(""),I(""),M(""),B(""),P(""),U(""),A(""),v(null),N(null)),m(null),F(null)}},[b,s]);const X=(o,i=!1)=>{const a=o.target.files[0];if(a){const d=new FileReader;d.onloadend=()=>{i?(F(a),N(d.result)):(m(a),v(d.result))},d.readAsDataURL(a)}},[x,Ne]=l.useState(null),[G,H]=l.useState(!1),ce=async o=>{if(o.preventDefault(),!T){S.error(t("upload.title_required"));return}if(!w&&r!=="event"&&r!=="article"&&!u){S.error(t("upload.file_required"));return}H(!0);try{const i=new FormData;u&&i.append("file",u),k&&i.append("cover",k);let a=f,d=y;if(u||k){const ee=(await we("/upload",i)).data;u&&(a=ee.fileUrl),k&&(d=ee.coverUrl)}const q={...s,title:T,category:c,tags:g,tag:g,url:a,audio:r==="audio"?a:null,artist:r==="audio"?le||t("common.unknown_artist"):null,video:r==="video"?a:null,image:r==="event"?d||"https://images.unsplash.com/photo-1517048676732-d65bc937f952?q=80&w=1000&auto=format&fit=crop":null,date:r==="event"?K:new Date().toLocaleDateString(),location:r==="event"?O:null,link:r==="event"?V:null,status:(s==null?void 0:s.status)||"pending",cover:d||(r==="image"?a:null)||"https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=1000&auto=format&fit=crop",thumbnail:d||(r==="image"?a:null)||"https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=1000&auto=format&fit=crop",excerpt:R,content:ne||`<p>${R}</p>`,description:R,...w?{}:{duration:0,size:"small"}};await _(q);const z=t(w?"upload.update_success":L?"upload.upload_success":"upload.upload_pending_review");S.success(z),h(),j(0)}catch(i){console.error("Upload failed:",i),S.error(t("upload.upload_failed"))}finally{H(!1)}},J=()=>{switch(r){case"video":return e.jsx(ve,{size:48,className:"text-gray-400"});case"audio":return e.jsx(te,{size:48,className:"text-gray-400"});case"article":return e.jsx(fe,{size:48,className:"text-gray-400"});case"event":return e.jsx(he,{size:48,className:"text-gray-400"});default:return e.jsx(xe,{size:48,className:"text-gray-400"})}},Q=(o=!1)=>{if(o)return"image/*";switch(r){case"video":return"video/*";case"audio":return"audio/*";case"article":return"image/*";case"event":return"image/*";default:return"image/*"}},W=o=>{o.preventDefault(),o.stopPropagation(),setIsDragging(!0)},Y=o=>{o.preventDefault(),o.stopPropagation(),setIsDragging(!1)},Z=o=>{o.preventDefault(),o.stopPropagation(),setIsDragging(!0)},D=(o,i=!1)=>{o.preventDefault(),o.stopPropagation(),setIsDragging(!1);const a=o.dataTransfer.files[0];if(a){const d=Q(i),q=new RegExp(d.replace("*",".*"));if(!a.type.match(q)){S.error(t("upload.invalid_file_type",{type:d}));return}const z=new FileReader;z.onloadend=()=>{i?(F(a),N(z.result)):(m(a),v(z.result))},z.readAsDataURL(a)}};return e.jsx(ue,{children:b&&e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",onClick:h,children:e.jsxs(se.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"relative bg-[#1a1a1a] border border-white/10 rounded-2xl w-full max-w-lg overflow-hidden shadow-2xl max-h-[90vh] overflow-y-auto custom-scrollbar z-10",onClick:o=>o.stopPropagation(),children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-purple-500/5 opacity-50 pointer-events-none"}),e.jsxs("div",{className:"p-6 border-b border-white/10 flex justify-between items-center sticky top-0 bg-[#1a1a1a]/95 backdrop-blur-md z-20",children:[e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[J()," ",t(w?"admin.edit_item":"common.upload")," ",t(`common.${r}`)]}),e.jsx("button",{onClick:h,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(oe,{size:24})})]}),e.jsxs("form",{onSubmit:ce,className:"p-6 space-y-6 relative z-10",children:[r!=="event"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:t(`common.${r}`)}),e.jsxs("div",{className:`relative border-2 border-dashed rounded-xl p-8 flex flex-col items-center justify-center group transition-all duration-300 bg-white/5 ${x==="main"?"border-indigo-500 bg-indigo-500/10 scale-[1.02]":"border-white/20 hover:border-white/40"}`,onDragEnter:o=>W(o),onDragLeave:Y,onDragOver:Z,onDrop:o=>D(o,!1),children:[e.jsx("input",{type:"file",accept:Q(),onChange:o=>X(o,!1),className:"absolute inset-0 opacity-0 cursor-pointer z-10"}),f?r==="audio"?e.jsxs("div",{className:"text-center relative z-20 pointer-events-none",children:[e.jsx(te,{size:48,className:"text-green-400 mx-auto mb-2"}),e.jsx("p",{className:"text-green-400 font-medium text-sm break-all",children:u==null?void 0:u.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t("upload.click_drag_replace")})]}):r==="video"?e.jsx("div",{className:"relative z-20 pointer-events-none w-full flex justify-center",children:e.jsx("video",{src:f,className:"max-h-48 rounded-lg",controls:!0})}):e.jsx("div",{className:"relative z-20 pointer-events-none",children:e.jsx("img",{src:f,alt:"Preview",className:"max-h-48 rounded-lg object-cover shadow-lg"})}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-center pointer-events-none",children:[e.jsx("div",{className:`mb-4 transition-transform duration-300 ${x==="main"?"scale-110 text-indigo-400":"group-hover:scale-110 text-gray-400"}`,children:x==="main"?e.jsx(ie,{size:48}):J()}),e.jsx("p",{className:"text-gray-300 font-medium",children:x==="main"?t("upload.drop_file"):`${t("common.upload")} ${t(`common.${r}`)}`}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:t("upload.drag_drop_browse")})]})]})]}),(r==="audio"||r==="video"||r==="event")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:t(r==="event"?"common.image":"common.cover")}),e.jsxs("div",{className:`relative border-2 border-dashed rounded-xl p-4 flex flex-col items-center justify-center group transition-all duration-300 bg-white/5 h-32 ${x==="cover"?"border-indigo-500 bg-indigo-500/10 scale-[1.02]":"border-white/20 hover:border-white/40"}`,onDragEnter:o=>W(o),onDragLeave:Y,onDragOver:Z,onDrop:o=>D(o,!0),children:[e.jsx("input",{type:"file",accept:"image/*",onChange:o=>X(o,!0),className:"absolute inset-0 opacity-0 cursor-pointer z-10"}),y?e.jsxs("div",{className:"relative h-full w-full flex justify-center items-center pointer-events-none",children:[e.jsx("img",{src:y,alt:"Cover Preview",className:"h-full rounded-lg object-contain"}),e.jsx("div",{className:`absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity ${x==="cover"?"opacity-100":""}`,children:e.jsx("p",{className:"text-xs text-white",children:t("upload.replace")})})]}):e.jsxs("div",{className:"flex flex-col items-center pointer-events-none",children:[e.jsx(pe,{size:24,className:`mb-1 transition-colors ${x==="cover"?"text-indigo-400":"text-gray-400"}`}),e.jsx("span",{className:`text-xs transition-colors ${x==="cover"?"text-indigo-300":"text-gray-500"}`,children:x==="cover"?t("upload.drop_image"):`${t("common.upload")} ${t("common.image")}`})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("common.title")}),e.jsx("input",{type:"text",required:!0,value:T,onChange:o=>n(o.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-white/30",placeholder:t("upload.title_placeholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("upload.tags")}),e.jsx(ye,{value:g,onChange:$,placeholder:t("upload.tags_placeholder")})]}),r==="event"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("common.date")}),e.jsx("input",{type:"date",required:!0,value:K,onChange:o=>P(o.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-white/30"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("common.location")}),e.jsx("input",{type:"text",required:!0,value:O,onChange:o=>U(o.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-white/30",placeholder:t("upload.location_placeholder")})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("upload.event_link")}),e.jsxs("div",{className:"relative",children:[e.jsx(ge,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"}),e.jsx("input",{type:"url",value:V,onChange:o=>A(o.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg pl-10 pr-4 py-2 text-white focus:outline-none focus:border-white/30",placeholder:"https://"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("admin.fields.description")}),e.jsx("textarea",{value:R,onChange:o=>I(o.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-white/30 h-24 resize-none",placeholder:t("upload.description_placeholder")})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-white/10",children:[e.jsx("button",{type:"button",onClick:h,className:"px-4 py-2 text-gray-400 hover:text-white transition-colors",children:t("common.cancel")}),e.jsx("button",{type:"submit",disabled:G,className:"px-6 py-2 bg-white text-black rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:G?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin"}),t("common.loading")]}):e.jsx(e.Fragment,{children:t(w?"common.save":"common.upload")})})]})]})]})})})};export{Ce as U};
