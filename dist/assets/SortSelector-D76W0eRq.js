import{j as e,a as l,R as re,A as te,m as V}from"./react-vendor-CXoD4tGQ.js";import{X as le,M as W,an as ce,ao as de,ap as ne,e as ue,I as ae,d as me,c as xe,F as he,n as i,aq as be}from"./ui-vendor-ChojsKpE.js";import{u as Y,c as pe,D as Z,e as ge}from"./index-D24czYHj.js";import{T as ie}from"./TagInput-gN0k0_Qy.js";const ze=({currentPage:c,totalPages:d,onPageChange:u})=>d<=1?null:e.jsxs("div",{className:"flex justify-center items-center space-x-2 mt-8 pb-8",children:[e.jsx("button",{onClick:()=>u(Math.max(1,c-1)),disabled:c===1,className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all text-white border border-white/10",children:"<"}),e.jsx("div",{className:"flex space-x-2 overflow-x-auto max-w-[200px] md:max-w-none scrollbar-hide",children:Array.from({length:d},(o,s)=>s+1).map(o=>e.jsx("button",{onClick:()=>u(o),className:`min-w-[40px] h-10 rounded-lg transition-all border font-bold ${c===o?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white border-transparent shadow-[0_0_10px_rgba(6,182,212,0.4)]":"bg-white/5 hover:bg-white/10 text-white border-white/10"}`,children:o},o))}),e.jsx("button",{onClick:()=>u(Math.min(d,c+1)),disabled:c===d,className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all text-white border border-white/10",children:">"})]}),Se=({isOpen:c,onClose:d,onUpload:u,type:o="image",initialData:s=null,customFields:ve=[]})=>{const{t}=Y(),{user:fe,isAdmin:we}=pe(),h=!!s,[m,R]=l.useState(null),[b,v]=l.useState((s==null?void 0:s.url)||(s==null?void 0:s.audio)||(s==null?void 0:s.video)||null),[p,I]=l.useState(null),[f,w]=l.useState((s==null?void 0:s.cover)||(s==null?void 0:s.thumbnail)||(s==null?void 0:s.image)||null),[j,N]=l.useState((s==null?void 0:s.title)||""),[O,G]=l.useState((s==null?void 0:s.category)||""),[y,k]=l.useState((s==null?void 0:s.tags)||""),[g,C]=l.useState((s==null?void 0:s.excerpt)||(s==null?void 0:s.description)||""),[$,z]=l.useState((s==null?void 0:s.content)||""),[P,S]=l.useState((s==null?void 0:s.artist)||""),[U,F]=l.useState((s==null?void 0:s.gameType)||"puzzle"),[T,A]=l.useState((s==null?void 0:s.gameDescription)||""),[_,q]=l.useState((s==null?void 0:s.date)||""),[H,E]=l.useState((s==null?void 0:s.location)||""),[X,L]=l.useState((s==null?void 0:s.link)||"");re.useEffect(()=>{c&&(s?(N(s.title||""),G(s.category||"未分类"),k(s.tags||""),C(s.excerpt||s.description||""),z(s.content||""),S(s.artist||""),F(s.gameType||"puzzle"),A(s.gameDescription||""),q(s.date||""),E(s.location||""),L(s.link||""),v(s.url||s.audio||s.video||null),w(s.cover||s.thumbnail||s.image||null)):(N(""),G("未分类"),k(""),C(""),z(""),S(""),F("puzzle"),A(""),q(""),E(""),L(""),v(null),w(null)),R(null),I(null))},[c,s]);const B=(r,x=!1)=>{const n=r.target.files[0];if(n){const a=new FileReader;a.onloadend=()=>{x?(I(n),w(a.result)):(R(n),v(a.result))},a.readAsDataURL(n)}},[M,J]=l.useState(!1),D=async r=>{if(r.preventDefault(),!j){i.error(t("upload.title_required"));return}if(!h&&o!=="event"&&!m){i.error(t("upload.file_required"));return}J(!0);try{const x=new FormData;m&&x.append("file",m),p&&x.append("cover",p);let n=b,a=f;if(m||p){const Q=(await ge("/upload",x)).data;m&&(n=Q.fileUrl),p&&(a=Q.coverUrl)}const se={...s,title:j,category:O,tags:y,tag:y,url:n,audio:o==="audio"?n:null,artist:o==="audio"?P||"Unknown Artist":null,video:o==="video"?n:null,image:o==="event"?a||"https://images.unsplash.com/photo-1517048676732-d65bc937f952?q=80&w=1000&auto=format&fit=crop":null,date:o==="event"?_:new Date().toLocaleDateString(),location:o==="event"?H:null,link:o==="event"?X:null,status:o==="event"?new Date(_)>new Date?"Upcoming":"Past":null,cover:a||(o==="image"?n:null)||"https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=1000&auto=format&fit=crop",thumbnail:a||(o==="image"?n:null)||"https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=1000&auto=format&fit=crop",excerpt:g,content:$||`<p>${g}</p>`,description:g,...h?{...o==="image"?{gameType:U,gameDescription:T}:{}}:{gameType:o==="image"?U:"puzzle",gameDescription:o==="image"?T:"User uploaded content",duration:0,size:"small"}};await u(se);const oe=h?"Updated successfully!":"Uploaded successfully!";i.success(oe),d()}catch(x){console.error("Upload failed:",x),i.error("Upload failed. Please try again.")}finally{J(!1)}},K=()=>{switch(o){case"video":return e.jsx(he,{size:48,className:"text-gray-400"});case"audio":return e.jsx(W,{size:48,className:"text-gray-400"});case"article":return e.jsx(xe,{size:48,className:"text-gray-400"});case"event":return e.jsx(me,{size:48,className:"text-gray-400"});default:return e.jsx(ae,{size:48,className:"text-gray-400"})}},ee=(r=!1)=>{if(r)return"image/*";switch(o){case"video":return"video/*";case"audio":return"audio/*";case"article":return"image/*";case"event":return"image/*";default:return"image/*"}};return e.jsx(te,{children:c&&e.jsx(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",onClick:d,children:e.jsxs(V.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"relative bg-[#1a1a1a] border border-white/10 rounded-2xl w-full max-w-lg overflow-hidden shadow-2xl max-h-[90vh] overflow-y-auto custom-scrollbar z-10",onClick:r=>r.stopPropagation(),children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-purple-500/5 opacity-50 pointer-events-none"}),e.jsxs("div",{className:"p-6 border-b border-white/10 flex justify-between items-center sticky top-0 bg-[#1a1a1a]/95 backdrop-blur-md z-20",children:[e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[K()," ",t(h?"admin.edit_item":"common.upload")," ",o.charAt(0).toUpperCase()+o.slice(1)]}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(le,{size:24})})]}),e.jsxs("form",{onSubmit:D,className:"p-6 space-y-6 relative z-10",children:[o!=="event"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:t(`common.${o}`)}),e.jsxs("div",{className:"relative border-2 border-dashed border-white/20 rounded-xl p-8 flex flex-col items-center justify-center group hover:border-white/40 transition-colors bg-white/5",children:[e.jsx("input",{type:"file",accept:ee(),onChange:r=>B(r,!1),className:"absolute inset-0 opacity-0 cursor-pointer z-10"}),b?o==="audio"?e.jsxs("div",{className:"text-center",children:[e.jsx(W,{size:48,className:"text-green-400 mx-auto mb-2"}),e.jsx("p",{className:"text-green-400 font-medium text-sm break-all",children:m==null?void 0:m.name})]}):o==="video"?e.jsx("video",{src:b,className:"max-h-48 rounded-lg",controls:!0}):e.jsx("img",{src:b,alt:"Preview",className:"max-h-48 rounded-lg object-cover"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 group-hover:scale-110 transition-transform duration-300",children:K()}),e.jsxs("p",{className:"text-gray-400 text-sm text-center",children:[t("common.upload")," ",t(`common.${o}`)]})]})]})]}),(o==="audio"||o==="video"||o==="event")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:t(o==="event"?"common.image":"common.cover")}),e.jsxs("div",{className:"relative border-2 border-dashed border-white/20 rounded-xl p-4 flex flex-col items-center justify-center group hover:border-white/40 transition-colors bg-white/5 h-32",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:r=>B(r,!0),className:"absolute inset-0 opacity-0 cursor-pointer z-10"}),f?e.jsx("img",{src:f,alt:"Cover Preview",className:"h-full rounded-lg object-contain"}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(ce,{size:24,className:"text-gray-400 mb-1"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t("common.upload")," ",t("common.image")]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("common.title")}),e.jsx("input",{type:"text",required:!0,value:j,onChange:r=>N(r.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-white/30",placeholder:"Enter title..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("upload.tags")}),e.jsx(ie,{value:y,onChange:k,placeholder:t("upload.tags_placeholder")})]}),o==="image"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Game Type"}),e.jsx(Z,{value:U,onChange:F,options:[{value:"益智",label:"益智"},{value:"动作",label:"动作"},{value:"策略",label:"策略"},{value:"角色扮演",label:"角色扮演"},{value:"冒险",label:"冒险"}],icon:de,buttonClassName:"bg-black/20 border-white/10 hover:bg-black/30 w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Game Description"}),e.jsx("input",{type:"text",value:T,onChange:r=>A(r.target.value),className:"w-full bg-black/20 border border-white/10 rounded-xl px-4 py-2.5 text-white focus:outline-none focus:border-white/30",placeholder:"Short game desc..."})]})]}),o==="event"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("common.date")}),e.jsx("input",{type:"date",required:!0,value:_,onChange:r=>q(r.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-white/30"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("common.location")}),e.jsx("input",{type:"text",required:!0,value:H,onChange:r=>E(r.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-white/30",placeholder:"e.g. Online, City Hall..."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"活动链接 (外部链接)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:16}),e.jsx("input",{type:"url",value:X,onChange:r=>L(r.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg pl-10 pr-4 py-2 text-white focus:outline-none focus:border-white/30",placeholder:"https://..."})]})]})]}),o==="audio"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:t("common.artist")}),e.jsx("input",{type:"text",value:P,onChange:r=>S(r.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-white/30",placeholder:"Artist name..."})]}),(o==="article"||o==="event")&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:[t("common.description")," (摘要)"]}),e.jsx("textarea",{required:!0,value:g,onChange:r=>C(r.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-white/30 h-24",placeholder:"Short description or excerpt..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"详细内容 (支持 HTML)"}),e.jsx("textarea",{value:$,onChange:r=>z(r.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-white/30 h-48 font-mono text-sm",placeholder:"<p>Detailed content here...</p>"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:d,className:"px-6 py-3 text-gray-400 hover:text-white transition-colors",disabled:M,children:t("common.cancel")}),e.jsx("button",{type:"submit",disabled:M,className:"px-8 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold transition-all shadow-lg shadow-indigo-500/20 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:M?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t("common.uploading"),"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:20}),t(h?"common.save":"common.upload")]})})]})]})]})})})},Ue=({sort:c,onSortChange:d})=>{const{t:u}=Y(),o=[{value:"newest",label:u("sort_filter.newest")},{value:"oldest",label:u("sort_filter.oldest")},{value:"likes",label:u("sort_filter.likes")},{value:"title",label:u("sort_filter.title")}];return e.jsx("div",{className:"w-40",children:e.jsx(Z,{value:c,onChange:d,options:o,icon:be,buttonClassName:"bg-neutral-900 rounded-full px-4 py-2 border-white/10 hover:bg-neutral-800"})})};export{ze as P,Ue as S,Se as U};
