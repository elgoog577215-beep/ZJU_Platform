import{a}from"./react-vendor-CXoD4tGQ.js";import{d as R}from"./index-k0FbQOqR.js";const L=(s,n={},p={})=>{const{keyPrefix:y="cache:",ttl:w=24*60*60*1e3,enabled:u=!0,dependencies:D=[]}=p,[P,c]=a.useState([]),[$,d]=a.useState({}),[x,i]=a.useState(!0),[C,g]=a.useState(null),[E,I]=a.useState(0),h=Object.keys(n).sort().reduce((r,e)=>(n[e]!==void 0&&n[e]!==null&&(r[e]=n[e]),r),{}),m=new URLSearchParams(h).toString(),f=`${y}${s}?${m}`,K=()=>{I(r=>r+1)};return a.useEffect(()=>{if(!u)return;(async()=>{const e=localStorage.getItem(f);let l=!1;if(e)try{const t=JSON.parse(e),o=Date.now();(!t.timestamp||o-t.timestamp<w)&&(c(t.data),t.pagination&&d(t.pagination),i(!1),l=!0)}catch(t){console.warn("Cache parse error",t),localStorage.removeItem(f)}l||i(!0);try{const t=await R.get(s,{params:h}),o=t.data.data!==void 0?t.data.data:t.data,S=t.data.pagination||{};c(o),d(S),g(null);const O={data:o,pagination:S,timestamp:Date.now()};localStorage.setItem(f,JSON.stringify(O))}catch(t){console.error(`Fetch error for ${s}`,t),l||g(t)}finally{i(!1)}})()},[s,m,E,u,...D]),{data:P,pagination:$,loading:x,error:C,setData:c,refresh:K}};export{L as u};
